openapi: 3.0.3
info:
  title: Changánet API
  description: API completa para la plataforma Changánet - Conexión entre clientes y profesionales
  version: 1.0.0
  contact:
    name: Equipo Changánet
    email: soporte@changanet.com

servers:
  - url: http://localhost:3002/api
    description: Servidor de desarrollo
  - url: https://api.changanet.com/api
    description: Servidor de producción

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        nombre:
          type: string
        email:
          type: string
          format: email
        rol:
          type: string
          enum: [cliente, profesional]
        esta_verificado:
          type: boolean

    Professional:
      type: object
      properties:
        id:
          type: string
          format: uuid
        usuario:
          $ref: '#/components/schemas/User'
        especialidad:
          type: string
        zona_cobertura:
          type: string
        tarifa_hora:
          type: number
          format: float
        calificacion_promedio:
          type: number
          format: float
        estado_verificacion:
          type: string
          enum: [pendiente, verificado, rechazado]

    Notification:
      type: object
      properties:
        id:
          type: string
          format: uuid
        titulo:
          type: string
        mensaje:
          type: string
        tipo:
          type: string
          enum: [mensaje, cotizacion, servicio_agendado, bienvenida]
        esta_leido:
          type: boolean
        creado_en:
          type: string
          format: date-time

paths:
  /auth/register:
    post:
      summary: Registrar nuevo usuario
      tags: [Autenticación]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - email
                - password
                - rol
              properties:
                name:
                  type: string
                  example: "Juan Pérez"
                email:
                  type: string
                  format: email
                  example: "juan@email.com"
                password:
                  type: string
                  minLength: 6
                  example: "password123"
                rol:
                  type: string
                  enum: [cliente, profesional]
                  example: "cliente"
      responses:
        201:
          description: Usuario registrado exitosamente
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  token:
                    type: string
                  user:
                    $ref: '#/components/schemas/User'

  /auth/login:
    post:
      summary: Iniciar sesión
      tags: [Autenticación]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
      responses:
        200:
          description: Login exitoso
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  token:
                    type: string
                  user:
                    $ref: '#/components/schemas/User'

  /search:
    get:
      summary: Buscar profesionales
      tags: [Búsqueda]
      parameters:
        - name: especialidad
          in: query
          schema:
            type: string
          description: Especialidad del profesional
        - name: zona_cobertura
          in: query
          schema:
            type: string
          description: Zona de cobertura
        - name: precio_min
          in: query
          schema:
            type: number
          description: Precio mínimo por hora
        - name: precio_max
          in: query
          schema:
            type: number
          description: Precio máximo por hora
        - name: sort_by
          in: query
          schema:
            type: string
            enum: [calificacion_promedio, tarifa_hora, distancia]
          description: Criterio de ordenamiento
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: Número de página
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
          description: Resultados por página
      responses:
        200:
          description: Lista de profesionales encontrados
          content:
            application/json:
              schema:
                type: object
                properties:
                  professionals:
                    type: array
                    items:
                      $ref: '#/components/schemas/Professional'
                  total:
                    type: integer
                  page:
                    type: integer
                  totalPages:
                    type: integer

  /notifications:
    get:
      summary: Obtener notificaciones del usuario
      tags: [Notificaciones]
      security:
        - bearerAuth: []
      parameters:
        - name: filter
          in: query
          schema:
            type: string
            enum: [all, unread, read]
          description: Filtro de notificaciones
      responses:
        200:
          description: Lista de notificaciones
          content:
            application/json:
              schema:
                type: object
                properties:
                  notifications:
                    type: array
                    items:
                      $ref: '#/components/schemas/Notification'
                  unreadCount:
                    type: integer

  /notifications/{id}/read:
    put:
      summary: Marcar notificación como leída
      tags: [Notificaciones]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID de la notificación
      responses:
        200:
          description: Notificación marcada como leída

  /notifications/read-all:
    put:
      summary: Marcar todas las notificaciones como leídas
      tags: [Notificaciones]
      security:
        - bearerAuth: []
      responses:
        200:
          description: Todas las notificaciones marcadas como leídas

  /ranking:
    get:
      summary: Obtener ranking de profesionales
      tags: [Ranking]
      responses:
        200:
          description: Lista de profesionales rankeados
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    posicion:
                      type: integer
                    profesional:
                      $ref: '#/components/schemas/User'
                    calificacion:
                      type: number
                    medallas:
                      type: object
                      properties:
                        calidad:
                          type: string
                          enum: [oro, plata, bronce]
                        experiencia:
                          type: string
                          enum: [oro, plata, bronce]

  /health:
    get:
      summary: Health check del servidor
      tags: [Sistema]
      responses:
        200:
          description: Estado del servidor
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "OK"
                  timestamp:
                    type: string
                    format: date-time

  /api/status:
    get:
      summary: Estado de servicios externos
      tags: [Sistema]
      responses:
        200:
          description: Estado de servicios configurados
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  services:
                    type: object
                    properties:
                      firebase:
                        type: string
                        enum: [configured, not configured]
                      sendgrid:
                        type: string
                        enum: [configured, not configured]
                      twilio:
                        type: string
                        enum: [configured, not configured]
                      sentry:
                        type: string
                        enum: [configured, not configured]
                  timestamp:
                    type: string
                    format: date-time