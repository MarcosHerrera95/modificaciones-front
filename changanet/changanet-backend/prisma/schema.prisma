generator client {
  provider = "prisma-client-js"
}

generator erd {
  provider = "prisma-erd-generator"
  output   = "../docs/database-diagram.png"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model cotizacion_respuestas {
  id             String       @id
  cotizacion_id  String
  profesional_id String
  precio         Float?
  comentario     String?
  estado         String       @default("PENDIENTE")
  creado_en      DateTime     @default(now())
  respondido_en  DateTime?
  usuarios       usuarios     @relation(fields: [profesional_id], references: [id])
  cotizaciones   cotizaciones @relation(fields: [cotizacion_id], references: [id])

  @@unique([cotizacion_id, profesional_id])
  @@index([estado])
  @@index([profesional_id])
  @@index([cotizacion_id])
}

model cotizaciones {
  id                        String                  @id
  cliente_id                String
  descripcion               String
  zona_cobertura            String?
  fotos_urls                String?
  profesionales_solicitados String?
  creado_en                 DateTime                @default(now())
  cotizacion_respuestas     cotizacion_respuestas[]
  usuarios                  usuarios                @relation(fields: [cliente_id], references: [id])

  @@index([creado_en])
  @@index([cliente_id])
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model coverage_zones {
  id                     String                   @id @default("lower(hex(randomblob(16)))")
  name                   String
  state                  String
  city                   String
  latitude               Float?
  longitude              Float?
  radius_km              Float?                   @default(5.0)
  is_active              Boolean?                 @default(true)
  created_at             DateTime?                @default(now())
  updated_at             DateTime?                @default(now())
  perfiles_profesionales perfiles_profesionales[]

  @@index([is_active], map: "idx_coverage_zones_active")
  @@index([city, state], map: "idx_coverage_zones_city")
  @@ignore
}

model cuentas_bancarias {
  id             String    @id
  profesional_id String
  cvu            String
  alias          String
  banco          String?
  titular        String?
  es_principal   Boolean   @default(false)
  verificada     Boolean   @default(false)
  creado_en      DateTime  @default(now())
  actualizado_en DateTime?
  usuarios       usuarios  @relation(fields: [profesional_id], references: [id])
  retiros        retiros[]

  @@index([verificada])
  @@index([profesional_id])
}

model disponibilidad {
  id                                               String     @id
  profesional_id                                   String
  fecha                                            DateTime
  hora_inicio                                      DateTime
  hora_fin                                         DateTime
  esta_disponible                                  Boolean    @default(true)
  reservado_por                                    String?
  reservado_en                                     DateTime?
  servicio_id                                      String?    @unique
  servicios                                        servicios? @relation(fields: [servicio_id], references: [id])
  usuarios_disponibilidad_reservado_porTousuarios  usuarios?  @relation("disponibilidad_reservado_porTousuarios", fields: [reservado_por], references: [id])
  usuarios_disponibilidad_profesional_idTousuarios usuarios   @relation("disponibilidad_profesional_idTousuarios", fields: [profesional_id], references: [id])

  @@index([esta_disponible, fecha])
  @@index([servicio_id])
  @@index([reservado_por])
  @@index([profesional_id, fecha])
}

model favoritos {
  id                                          String   @id
  cliente_id                                  String
  profesional_id                              String
  creado_en                                   DateTime @default(now())
  usuarios_favoritos_profesional_idTousuarios usuarios @relation("favoritos_profesional_idTousuarios", fields: [profesional_id], references: [id])
  usuarios_favoritos_cliente_idTousuarios     usuarios @relation("favoritos_cliente_idTousuarios", fields: [cliente_id], references: [id])

  @@unique([cliente_id, profesional_id])
  @@index([profesional_id])
  @@index([cliente_id])
}

model logros {
  id             String           @id
  nombre         String
  descripcion    String
  icono          String
  categoria      String
  criterio       String
  puntos         Int              @default(0)
  activo         Boolean          @default(true)
  creado_en      DateTime         @default(now())
  logros_usuario logros_usuario[]

  @@index([activo])
  @@index([categoria])
}

model logros_usuario {
  id          String   @id
  usuario_id  String
  logro_id    String
  obtenido_en DateTime @default(now())
  logros      logros   @relation(fields: [logro_id], references: [id])
  usuarios    usuarios @relation(fields: [usuario_id], references: [id])

  @@unique([usuario_id, logro_id])
  @@index([logro_id])
  @@index([usuario_id])
}

model mensajes {
  id                                          String   @id
  remitente_id                                String
  destinatario_id                             String
  contenido                                   String
  url_imagen                                  String?
  esta_leido                                  Boolean  @default(false)
  creado_en                                   DateTime @default(now())
  usuarios_mensajes_destinatario_idTousuarios usuarios @relation("mensajes_destinatario_idTousuarios", fields: [destinatario_id], references: [id])
  usuarios_mensajes_remitente_idTousuarios    usuarios @relation("mensajes_remitente_idTousuarios", fields: [remitente_id], references: [id])

  @@index([creado_en])
  @@index([remitente_id, destinatario_id, creado_en])
  @@index([destinatario_id, creado_en])
  @@index([remitente_id, creado_en])
}

model notificaciones {
  id         String   @id
  usuario_id String
  tipo       String
  mensaje    String
  esta_leido Boolean  @default(false)
  creado_en  DateTime @default(now())
  usuarios   usuarios @relation(fields: [usuario_id], references: [id])
}

model pagos {
  id                                      String    @id
  servicio_id                             String    @unique
  cliente_id                              String
  profesional_id                          String
  monto_total                             Float
  comision_plataforma                     Float
  monto_profesional                       Float
  mercado_pago_id                         String?   @unique
  estado                                  String    @default("pendiente")
  metodo_pago                             String?
  fecha_pago                              DateTime?
  fecha_liberacion                        DateTime?
  url_comprobante                         String?
  creado_en                               DateTime  @default(now())
  usuarios_pagos_profesional_idTousuarios usuarios  @relation("pagos_profesional_idTousuarios", fields: [profesional_id], references: [id])
  usuarios_pagos_cliente_idTousuarios     usuarios  @relation("pagos_cliente_idTousuarios", fields: [cliente_id], references: [id])
  servicios                               servicios @relation(fields: [servicio_id], references: [id])

  @@index([mercado_pago_id])
  @@index([estado])
  @@index([profesional_id])
  @@index([cliente_id])
}

model perfiles_profesionales {
  usuario_id                 String                     @id
  especialidad               String
  especialidades             String?
  anos_experiencia           Int?
  zona_cobertura             String
  latitud                    Float?
  longitud                   Float?
  tipo_tarifa                String                     @default("hora")
  tarifa_hora                Float?
  tarifa_servicio            Float?
  tarifa_convenio            String?
  descripcion                String?
  url_foto_perfil            String?
  url_foto_portada           String?
  esta_disponible            Boolean                    @default(true)
  calificacion_promedio      Float?
  estado_verificacion        String                     @default("pendiente")
  verificado_en              DateTime?
  url_documento_verificacion String?
  coverage_zone_id           String?
  profile_completion_score   Int?                       @default(0)
  profile_views_count        Int?                       @default(0)
  last_profile_update        DateTime?                  @default(now())
  usuarios                   usuarios                   @relation(fields: [usuario_id], references: [id])
  coverage_zones             coverage_zones?            @relation(fields: [coverage_zone_id], references: [id], onDelete: NoAction, onUpdate: NoAction) @ignore
  professional_specialties   professional_specialties[]

  @@index([last_profile_update], map: "idx_professionals_last_update")
  @@index([profile_completion_score], map: "idx_professionals_completion_score")
  @@index([esta_disponible])
  @@index([tipo_tarifa])
  @@index([especialidad, zona_cobertura, calificacion_promedio])
  @@index([latitud, longitud])
  @@index([calificacion_promedio])
  @@index([zona_cobertura])
  @@index([especialidad])
}

model professional_specialties {
  professional_id        String
  specialty_id           String
  is_primary             Boolean?               @default(false)
  created_at             DateTime?              @default(now())
  specialties            specialties            @relation(fields: [specialty_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  perfiles_profesionales perfiles_profesionales @relation(fields: [professional_id], references: [usuario_id], onDelete: Cascade, onUpdate: NoAction)

  @@id([professional_id, specialty_id])
  @@index([specialty_id], map: "idx_professional_specialties_specialty")
  @@index([professional_id], map: "idx_professional_specialties_professional")
}

model refresh_tokens {
  id         String   @id
  user_id    String
  token_hash String   @unique
  issued_at  DateTime @default(now())
  expires_at DateTime
  revoked    Boolean  @default(false)
  usuarios   usuarios @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([expires_at])
  @@index([token_hash])
  @@index([user_id])
}

model resenas {
  id           String    @id
  servicio_id  String    @unique
  cliente_id   String
  calificacion Int
  comentario   String?
  url_foto     String?
  creado_en    DateTime  @default(now())
  usuarios     usuarios  @relation(fields: [cliente_id], references: [id])
  servicios    servicios @relation(fields: [servicio_id], references: [id])

  @@index([servicio_id])
}

model retiros {
  id                String            @id
  profesional_id    String
  monto             Float
  cuenta_id         String
  estado            String            @default("procesando")
  fecha_solicitud   DateTime          @default(now())
  fecha_procesado   DateTime?
  fecha_acreditado  DateTime?
  referencia        String?
  notas             String?
  creado_en         DateTime          @default(now())
  cuentas_bancarias cuentas_bancarias @relation(fields: [cuenta_id], references: [id])
  usuarios          usuarios          @relation(fields: [profesional_id], references: [id])

  @@index([fecha_solicitud])
  @@index([estado])
  @@index([profesional_id])
}

model servicios {
  id                                          String                  @id
  cliente_id                                  String
  profesional_id                              String
  descripcion                                 String
  estado                                      String                  @default("PENDIENTE")
  fecha_agendada                              DateTime?
  creado_en                                   DateTime                @default(now())
  completado_en                               DateTime?
  es_urgente                                  Boolean                 @default(false)
  servicio_recurrente_id                      String?
  disponibilidad                              disponibilidad?
  pagos                                       pagos?
  resenas                                     resenas?
  servicios_recurrrentes                      servicios_recurrrentes? @relation(fields: [servicio_recurrente_id], references: [id])
  usuarios_servicios_profesional_idTousuarios usuarios                @relation("servicios_profesional_idTousuarios", fields: [profesional_id], references: [id])
  usuarios_servicios_cliente_idTousuarios     usuarios                @relation("servicios_cliente_idTousuarios", fields: [cliente_id], references: [id])

  @@index([profesional_id, fecha_agendada])
  @@index([cliente_id, fecha_agendada])
  @@index([fecha_agendada])
  @@index([es_urgente, estado])
  @@index([estado, creado_en])
  @@index([profesional_id, estado])
  @@index([cliente_id, estado])
  @@index([es_urgente])
  @@index([creado_en])
  @@index([estado])
  @@index([profesional_id])
  @@index([cliente_id])
}

model servicios_recurrrentes {
  id                                                       String      @id
  cliente_id                                               String
  profesional_id                                           String
  descripcion                                              String
  frecuencia                                               String
  dia_semana                                               Int?
  dia_mes                                                  Int?
  hora_inicio                                              String
  duracion_horas                                           Float
  tarifa_base                                              Float
  descuento_recurrencia                                    Float       @default(0)
  fecha_inicio                                             DateTime
  fecha_fin                                                DateTime?
  activo                                                   Boolean     @default(true)
  creado_en                                                DateTime    @default(now())
  actualizado_en                                           DateTime?
  servicios                                                servicios[]
  usuarios_servicios_recurrrentes_profesional_idTousuarios usuarios    @relation("servicios_recurrrentes_profesional_idTousuarios", fields: [profesional_id], references: [id])
  usuarios_servicios_recurrrentes_cliente_idTousuarios     usuarios    @relation("servicios_recurrrentes_cliente_idTousuarios", fields: [cliente_id], references: [id])

  @@index([frecuencia])
  @@index([fecha_inicio])
  @@index([activo])
  @@index([profesional_id])
  @@index([cliente_id])
}

model specialties {
  id                       String                     @id @default("lower(hex(randomblob(16)))")
  name                     String                     @unique(map: "sqlite_autoindex_specialties_2")
  category                 String
  description              String?
  is_active                Boolean?                   @default(true)
  created_at               DateTime?                  @default(now())
  updated_at               DateTime?                  @default(now())
  professional_specialties professional_specialties[]

  @@index([is_active], map: "idx_specialties_active")
  @@index([category], map: "idx_specialties_category")
}

model usuarios {
  id                                                                     String                   @id
  email                                                                  String                   @unique
  hash_contrasena                                                        String?
  nombre                                                                 String
  telefono                                                               String?
  rol                                                                    String                   @default("cliente")
  esta_verificado                                                        Boolean                  @default(false)
  bloqueado                                                              Boolean                  @default(false)
  bloqueado_hasta                                                        DateTime?
  failed_login_attempts                                                  Int                      @default(0)
  token_verificacion                                                     String?                  @unique
  token_expiracion                                                       DateTime?
  creado_en                                                              DateTime                 @default(now())
  actualizado_en                                                         DateTime?
  google_id                                                              String?                  @unique
  facebook_id                                                            String?                  @unique
  url_foto_perfil                                                        String?
  fcm_token                                                              String?
  sms_enabled                                                            Boolean                  @default(false)
  direccion                                                              String?
  preferencias_servicio                                                  String?
  notificaciones_push                                                    Boolean                  @default(true)
  notificaciones_email                                                   Boolean                  @default(true)
  notificaciones_sms                                                     Boolean                  @default(false)
  notificaciones_servicios                                               Boolean                  @default(true)
  notificaciones_mensajes                                                Boolean                  @default(true)
  notificaciones_pagos                                                   Boolean                  @default(true)
  notificaciones_marketing                                               Boolean                  @default(false)
  cotizacion_respuestas                                                  cotizacion_respuestas[]
  cotizaciones                                                           cotizaciones[]
  cuentas_bancarias                                                      cuentas_bancarias[]
  disponibilidad_disponibilidad_reservado_porTousuarios                  disponibilidad[]         @relation("disponibilidad_reservado_porTousuarios")
  disponibilidad_disponibilidad_profesional_idTousuarios                 disponibilidad[]         @relation("disponibilidad_profesional_idTousuarios")
  favoritos_favoritos_profesional_idTousuarios                           favoritos[]              @relation("favoritos_profesional_idTousuarios")
  favoritos_favoritos_cliente_idTousuarios                               favoritos[]              @relation("favoritos_cliente_idTousuarios")
  logros_usuario                                                         logros_usuario[]
  mensajes_mensajes_destinatario_idTousuarios                            mensajes[]               @relation("mensajes_destinatario_idTousuarios")
  mensajes_mensajes_remitente_idTousuarios                               mensajes[]               @relation("mensajes_remitente_idTousuarios")
  notificaciones                                                         notificaciones[]
  pagos_pagos_profesional_idTousuarios                                   pagos[]                  @relation("pagos_profesional_idTousuarios")
  pagos_pagos_cliente_idTousuarios                                       pagos[]                  @relation("pagos_cliente_idTousuarios")
  perfiles_profesionales                                                 perfiles_profesionales?
  refresh_tokens                                                         refresh_tokens[]
  resenas                                                                resenas[]
  retiros                                                                retiros[]
  servicios_servicios_profesional_idTousuarios                           servicios[]              @relation("servicios_profesional_idTousuarios")
  servicios_servicios_cliente_idTousuarios                               servicios[]              @relation("servicios_cliente_idTousuarios")
  servicios_recurrrentes_servicios_recurrrentes_profesional_idTousuarios servicios_recurrrentes[] @relation("servicios_recurrrentes_profesional_idTousuarios")
  servicios_recurrrentes_servicios_recurrrentes_cliente_idTousuarios     servicios_recurrrentes[] @relation("servicios_recurrrentes_cliente_idTousuarios")
  verification_requests                                                  verification_requests?

  @@index([sms_enabled])
  @@index([telefono])
  @@index([esta_verificado])
  @@index([rol])
}

model verification_requests {
  id               String    @id
  usuario_id       String    @unique
  documento_url    String
  estado           String    @default("pendiente")
  comentario_admin String?
  creado_en        DateTime  @default(now())
  revisado_en      DateTime?
  revisado_por     String?
  usuarios         usuarios  @relation(fields: [usuario_id], references: [id])
}
